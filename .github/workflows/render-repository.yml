# SPDX-FileCopyrightText: 2025 RAprogramm <andrey.rozanov.vl@gmail.com>
#
# SPDX-License-Identifier: MIT

name: Render repository metrics

on:
  workflow_dispatch:
    inputs:
      branch_name:
        description: "Branch name used for the metrics refresh PR."
        required: false
      target_owner:
        description: "GitHub account owning the repository."
        required: false
        default: RAprogramm
      target_repo:
        description: "Repository name to render metrics for."
        required: true
      target_path:
        description: "Destination path for the generated metrics artifact."
        required: false
      temp_artifact:
        description: "Intermediate artifact filename produced by metrics renderer."
        required: false
      contributors_branch:
        description: "Repository branch analyzed by contributors plugin."
        required: false
  workflow_call:
    inputs:
      branch_name:
        description: "Branch name used for the metrics refresh PR."
        required: false
        type: string
      contributors_branch:
        description: "Repository branch analyzed by contributors plugin."
        required: false
        type: string
      target_owner:
        description: "GitHub account owning the repository."
        required: false
        type: string
        default: RAprogramm
      target_repo:
        description: "Repository name to render metrics for."
        required: true
        type: string
      target_path:
        description: "Destination path for the generated metrics artifact."
        required: false
        type: string
      temp_artifact:
        description: "Intermediate artifact filename produced by metrics renderer."
        required: false
        type: string
    secrets:
      CLASSIC:
        required: true

jobs:
  render:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v5

      - name: Render metrics
        uses: ./.github/actions/render-repository
        with:
          classic_token: ${{ secrets.CLASSIC }}
          target_owner: ${{ inputs.target_owner || github.repository_owner }}
          target_repo: ${{ inputs.target_repo }}
          branch_name: ${{ inputs.branch_name || format('ci/metrics-refresh-{0}', inputs.target_repo) }}
          contributors_branch: ${{ inputs.contributors_branch }}
          target_path: ${{ inputs.target_path || format('metrics/{0}.svg', inputs.target_repo) }}
          temp_artifact: ${{ inputs.temp_artifact || format('.metrics-tmp/{0}.svg', inputs.target_repo) }}
